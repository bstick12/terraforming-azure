#!/bin/bash -exu

main() {
  local password="$1"

  export OM_TARGET="https://$(terraform output ops_manager_dns)"
  export OM_USERNAME="admin"
  export OM_PASSWORD="${password}"

  om -k configure-authentication -dp "${OM_PASSWORD}"
  om -k configure-director --config <(texplate execute ci/assets/template/director-config.yml -f  <(jq -e --raw-output '.modules[0].outputs | map_values(.value)' terraform.tfstate) -o yaml)
}

main "$@"
